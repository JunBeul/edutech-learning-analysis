# 백엔드/프론트엔드 가이던스 문구 책임 분리 이슈 정리

---

## 전체 요약

리스크 예측 결과를 사용자에게 안내할 때, "가이던스 문구를 어디서 생성할 것인가"가 핵심 설계 이슈였습니다.  
논의 대상은 두 가지였습니다. 첫째, 백엔드가 계산 결과를 바탕으로 완성 문장을 직접 반환하는 방식. 둘째, 백엔드는 구조화된 값만 반환하고 프론트엔드가 문장을 조합하는 방식입니다.

현행 프로젝트는 교사용 CSV 리포트와 대시보드 문구의 일관성이 매우 중요하고, 문구 종류도 제한적이어서 백엔드 생성 방식이 운영 효율 면에서 유리했습니다. 다만 중장기적으로 다국어, 채널별 문구 차등, AB 테스트가 필요해질 가능성을 고려해 `code + params` 전환 경로를 문서화했습니다.

---

## 문제 정의

1. 동일 의미의 메시지를 백엔드와 프론트엔드 중 어느 계층에서 생성할지 기준이 불명확했습니다.
2. CSV 리포트, API 응답, UI 문구의 표현이 서로 달라질 경우 운영 신뢰도와 사용자 이해도가 동시에 저하될 수 있었습니다.
3. 현재 요구사항은 고정 문구 중심이지만, 향후 i18n 또는 화면별 문구 길이 최적화 요구가 생기면 현재 구조가 제약이 될 수 있었습니다.
4. 팀 내 구현 관점이 달라 기능 추가 시 매번 책임 경계를 재논의해야 하는 비효율이 발생했습니다.

---

## 원인 파악

1. 계산 로직과 문구 생성 로직이 하나의 서비스 계층에 결합되어 있어, 책임 분리 논의가 기능 구현 이후에야 드러났습니다.
2. 단기 목표와 장기 목표가 다릅니다.

- 단기 목표: 정확한 문구, 빠른 구현, 리포트와 UI 문구 동기화.
- 장기 목표: 다국어, 채널별 표현 차등, 문구 실험.

3. 메시지 스펙의 안정성이 낮았습니다.

- 어떤 값은 숫자로 고정되어도 되지만, 어떤 값은 표현 규칙(반올림, 단위, 조사 처리)에 따라 달라집니다.
- 표현 규칙이 명세로 분리되지 않으면 구현 위치에 따라 결과가 달라질 수 있습니다.

4. 실패 비용이 비대칭입니다.

- 백엔드 단일 생성은 프론트 변경 비용이 낮은 대신 표현 유연성이 낮습니다.
- 프론트 생성은 유연성이 높은 대신 문구 정합성 검증 비용이 커집니다.

---

## 해결 방안

1. 현행 운영 원칙을 명확화했습니다.

- 현재 단계에서는 백엔드가 계산과 문구 생성을 함께 책임집니다.
- API 응답과 CSV 생성 로직이 동일 규칙을 사용하도록 유지합니다.

2. 전환 가능한 메시지 규격을 병행 설계했습니다.

- 구조: `guidance.code` + `guidance.params`
- 예시:

```json
{
	"guidance": {
		"code": "NEED_MIN_FINAL_SCORE",
		"params": {
			"min_score": 37.2,
			"max_score": 100
		}
	}
}
```

3. 단계별 적용 기준을 정리했습니다.

- 조건 A: 문구 패턴이 적고 리포트 동등성이 우선이면 백엔드 문장 생성 유지.
- 조건 B: 다국어/플랫폼별 문구 분기가 늘어나면 `code + params` 전환.
- 조건 C: 분석 실험(문구 AB 테스트)이 필요하면 프론트 렌더링 책임 확대.

4. 품질 기준을 함께 정의했습니다.

- 동일 입력에 대해 CSV, API, UI의 의미가 일치할 것.
- 숫자 포맷팅 규칙(소수점, 단위, 반올림)은 단일 사양으로 유지할 것.
- 메시지 템플릿 변경 시 회귀 테스트 포인트를 명시할 것.

---

## 결과

1. 현재 프로젝트 범위에서는 백엔드 문구 생성이 가장 단순하고 안정적인 선택임을 팀 기준으로 합의했습니다.
2. 중장기 확장 시 바로 전환할 수 있도록 `code + params` 구조를 병행 설계해 기술 부채를 낮췄습니다.
3. 메시지 책임 경계가 문서화되어 신규 기능 추가 시 의사결정 속도가 빨라졌습니다.
4. 운영 관점에서 "정확도 우선 단계"와 "유연성 확장 단계"를 분리해 관리할 수 있게 되었습니다.

---

## 관련 파일

- `backend/api/main.py`
- `backend/src/report_logic.py`
- `backend/scripts/generate_prediction_report.py`
- `backend/scripts/_legacy_generate_prediction_report.py`
- `client/src/shared/columnLabels.ts`
- `docs/issues_backend_frontend_guidance_design.md`

