# 테이블 Sticky 헤더와 가로 스크롤 이슈 정리

---

## 전체 요약

대시보드 테이블에서 "세로 스크롤 시 헤더 고정"과 "가로 스크롤 지원"을 동시에 만족시키는 과정에서 `position: sticky` 기반 구현이 환경별로 불안정하게 동작했습니다.  
문제의 본질은 CSS 한 줄로 해결 가능한 수준이 아니라, 스크롤 컨테이너 구조, 테이블 렌더링 방식, 스크롤 동기화 경로가 함께 맞아야 하는 복합 UI 이슈였습니다.

최종적으로 원본 헤더와 별도 오버레이 헤더를 분리하고, 오버레이를 `position: fixed`로 제어하는 구조를 채택했습니다. 여기에 컬럼 너비 동기화와 `translate3d` 기반 실시간 스크롤 반영을 적용해 어긋남과 지연을 해소했습니다.

---

## 문제 정의

1. 일부 레이아웃에서 `thead th { position: sticky; }`가 동작하지 않거나 조건에 따라 해제되었습니다.
2. 가로 스크롤 시 헤더와 바디가 미세하게 어긋나 표 해석 신뢰도가 낮아졌습니다.
3. 스크롤 이벤트 반영 지연으로 고정 헤더가 끊겨 보이고, 체감 성능이 저하되었습니다.
4. 브라우저와 OS 조합에 따라 재현 패턴이 달라 디버깅과 운영 대응 비용이 증가했습니다.
5. 필터 팝오버 같은 헤더 부가 기능이 고정 헤더 상태와 충돌할 위험이 있었습니다.

---

## 원인 파악

1. `sticky` 기준 컨테이너 문제.
- `sticky`는 가장 가까운 스크롤/overflow 조상을 기준으로 좌표를 계산합니다.
- 래퍼 구조가 바뀌면 기준 컨테이너가 달라져 동작 안정성이 떨어졌습니다.

2. 테이블 렌더링 조합 문제.
- `table + sticky + border-collapse` 조합에서 브라우저별 서브픽셀 처리 차이가 발생했습니다.
- 동일 코드라도 헤더/바디 경계선과 폭 계산이 달라지는 현상이 나타났습니다.

3. 스크롤 동기화 경로 문제.
- `scrollLeft`를 React state로 전달해 렌더링을 거치는 방식은 프레임 지연을 만들었습니다.
- 지연이 누적되면 헤더와 바디가 순간적으로 분리되어 보였습니다.

4. 단일 헤더 책임 과부하.
- 한 헤더 구조에서 고정, 가로 스크롤, 반응형, 부가 인터랙션을 모두 처리하려다 조건 분기가 복잡해졌습니다.

---

## 해결 방안

1. 1차 보정: 컨테이너 역할 분리.
- 가시 영역 래퍼와 실제 가로 스크롤 래퍼를 분리.
- 테이블에 `min-width: max-content`, `border-collapse: separate`를 적용해 폭 계산 일관성을 확보.

2. 2차 구조 전환: 오버레이 헤더 도입.
- 원본 `thead`는 문서 흐름에 유지.
- 고정 조건 충족 시 별도 헤더를 `position: fixed`로 렌더링.
- 원본 테이블의 컬럼 너비/위치를 읽어 오버레이 헤더와 동기화.

3. 3차 성능 보정: 직접 변환 적용.
- 가로 스크롤 변화는 오버레이 헤더에 `translate3d(-scrollLeft, 0, 0)`로 직접 반영.
- `will-change: transform`을 적용해 브라우저 렌더 최적화를 유도.

4. 훅 기반 책임 분리.
- `useFixedTableHeader`가 고정 조건 판단, 위치 계산, 너비 동기화를 담당.
- `DashboardTable`은 렌더링 책임에 집중.
- 필터 팝오버는 별도 훅(`useTableFilterPopover`)에서 앵커 추적을 수행해 충돌을 완화.

5. 검증 포인트 정리.
- 세로 스크롤에서 고정 진입/이탈 조건 점검.
- 가로 스크롤 최대 구간에서 헤더/바디 정렬 점검.
- 컬럼 리사이즈 또는 뷰포트 변경 시 오버레이 너비 재동기화 점검.
- 필터 팝오버와 고정 헤더 동시 사용 시 좌표 충돌 점검.

---

## 결과

1. 고정 헤더 동작이 레이아웃 변화와 가로 스크롤 상황에서 일관되게 유지되었습니다.
2. 헤더/바디 수평 정렬 오차가 실사용 수준에서 해소되어 데이터 가독성이 개선되었습니다.
3. 스크롤 반영이 프레임 단위로 자연스러워져 UI 끊김이 줄었습니다.
4. 고정 헤더와 필터 인터랙션 충돌 가능성이 낮아져 기능 확장 안정성이 높아졌습니다.
5. 재사용 가능한 패턴(원본 헤더 + 오버레이 헤더 + 동기화 훅)으로 정리되어 유지보수 비용이 감소했습니다.

---

## 관련 파일

- `client/src/pages/DashboardPage.tsx`
- `client/src/components/dashboard/DashboardTable.tsx`
- `client/src/hooks/useFixedTableHeader.ts`
- `client/src/hooks/useTableFilterPopover.ts`
- `client/src/styles/table.scss`
- `docs/issues_table_sticky_and_horizontal_scroll.md`
